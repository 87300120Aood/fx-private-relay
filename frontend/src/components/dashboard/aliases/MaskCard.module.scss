@use "~@mozilla-protocol/core/protocol/css/includes/lib" as mp;
@use "../../../styles/tokens";

.card {
  background-color: tokens.$color-white;
  border-radius: mp.$border-radius-md;
  transition:
    box-shadow 200ms ease-in-out,
    opacity 200ms ease-in-out;

  &.is-enabled {
    box-shadow: mp.$box-shadow-sm;
  }
  &:not(.is-enabled) {
    opacity: 0.7;
  }
}

.bar {
  display: flex;
  align-items: center;
  gap: mp.$spacing-sm;
  padding: mp.$spacing-sm;

  .summary {
    flex: 1 1 auto;
    // Override flex children's default `min-width: auto` to allow the summary
    // to shrink instead of pushing out the collapse button:
    min-width: 0;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    position: relative;

    @media screen and #{mp.$mq-md} {
      gap: mp.$spacing-sm;
      flex-wrap: nowrap;
    }

    .label-editor-wrapper {
      @media screen and #{mp.$mq-md} {
        // Same as .summary's gap:
        padding-inline-end: mp.$spacing-sm;
        border-right: 1px solid tokens.$color-grey-10;
      }
    }

    .copy-button-wrapper {
      display: flex;
      align-items: center;
      overflow: hidden;

      @media screen and #{mp.$mq-md} {
        gap: mp.$spacing-sm;
      }
      @media screen and (max-width: mp.$screen-xs) {
        overflow: hidden;
      }
    }

    .copy-button {
      display: flex;
      align-items: center;
      gap: mp.$spacing-xs;
      background-color: transparent;
      color: tokens.$color-blue-50;
      border-style: none;
      font-family: mp.$font-stack-firefox;
      font-weight: 500;
      border-radius: mp.$border-radius-sm;
      cursor: pointer;
      overflow: inherit;

      &:hover {
        color: tokens.$color-green-70;
      }

      samp {
        font-family: inherit;
        align-self: start;
        white-space: nowrap;
        overflow: inherit;
        text-overflow: ellipsis;
      }

      .copy-icon {
        width: 15px; // Fixed size for the copy icon
        flex: 1 0 auto; // Avoid copied icon shrinking
      }
    }

    .copied-confirmation {
      background-color: tokens.$color-green-50;
      padding: mp.$spacing-xs mp.$spacing-sm;
      border-radius: mp.$border-radius-md;
      font-weight: 600;
      opacity: 1;
      pointer-events: none;
      z-index: 2; // Places copied label above promotions label

      @media screen and (max-width: mp.$screen-md) {
        @include mp.text-body-sm;
      }
      @media screen and (max-width: mp.$content-sm) {
        position: absolute;
        right: 0;
      }

      &[aria-hidden="true"] {
        opacity: 0;
        // Only fade out when disappearing:
        transition: opacity 2s;
      }
    }

    .block-level-label {
      flex: 1 0 auto;
      text-align: end;
      color: tokens.$color-grey-50;
      display: none;

      @media screen and #{mp.$mq-lg} {
        display: initial;
      }
    }
  }

  .expand-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
    border-style: none;
    cursor: pointer;
    color: tokens.$color-grey-40;
    border-radius: mp.$border-radius-sm;
    width: mp.$layout-sm;
    z-index: 3; // Ensures that the button gets placed above the copied label (needed for long custom domains at viewport width ~ 780px)

    @media (any-pointer: coarse) {
      width: mp.$layout-md;
    }

    &:hover {
      background-color: tokens.$color-grey-05;
      color: tokens.$color-blue-50;
    }

    svg {
      transition: transform 200ms;
    }

    &[aria-pressed="true"] svg {
      transform: rotate(0.5turn);
    }
  }
}

// This wrapper is a bit of a hack to allow animating the expanding/collapsing
// of the details area. For more info, see
// https://chriscoyier.net/2022/12/21/things-css-could-still-use-heading-into-2023/#animate-to-auto
.details-wrapper {
  display: grid;
  grid-template-rows: 0fr;
  overflow: hidden;
  transition: grid-template-rows 500ms ease-in-out;
  position: relative;

  @media (prefers-reduced-motion: no-preference) {
    transition-duration: 200ms;
  }

  &:not([hidden]) {
    grid-template-rows: 1fr;

    .details {
      border-top: 1px solid tokens.$color-grey-10;

      @media screen and #{mp.$mq-md} {
        padding: mp.$spacing-md mp.$spacing-lg;
      }
    }
  }

  .details {
    min-height: 0;
    transition: padding 200ms ease-in-out;

    .stats {
      @media screen and (max-width: mp.$screen-md) {
        display: flex;
        flex-direction: column;
        padding-inline: mp.$spacing-md;
        border-bottom: 1px solid tokens.$color-grey-10;

        .stat {
          display: flex;
          justify-content: space-between;
          padding-block: mp.$spacing-sm;

          &:not(:last-child) {
            border-bottom: 1px solid tokens.$color-grey-10;
          }

          // De-emphasise stats for:
          // - blocked emails when a mask is not blocking emails,
          .is-enabled.is-not-blocking-promotionals &.blocked-stat,
          // - replies when a mask is not passing through replies,
          .is-disabled &.replies-stat,
          // - tracker removal when a mask is not removing trackers, and
          .is-enabled.is-not-removing-trackers &.trackers-removed-stat,
          .is-disabled &.trackers-removed-stat,
          // - forwarded emails when a mask is not forwarding emails.
          .is-disabled &.forwarded-stat {
            color: tokens.$color-grey-40;
          }

          dt {
            @include mp.text-body-md;
          }

          dd {
            @include mp.text-body-lg;
            font-weight: 700;
          }
        }
      }
      @media screen and #{mp.$mq-md} {
        display: flex;
        gap: mp.$spacing-md;
        justify-content: space-between;
        width: 100%;

        .stat {
          flex: 1 1 0;
          display: flex;
          flex-direction: column-reverse;
          align-items: center;
          background-color: tokens.$color-grey-05;
          padding: mp.$spacing-sm;
          border-radius: mp.$border-radius-sm;

          // De-emphasise stats for:
          // - blocked emails when a mask is not blocking emails,
          .is-enabled.is-not-blocking-promotionals &.blocked-stat,
          // - replies when a mask is not passing through replies,
          .is-disabled &.replies-stat,
          // - tracker removal when a mask is not removing trackers, and
          .is-enabled.is-not-removing-trackers &.trackers-removed-stat,
          .is-disabled &.trackers-removed-stat,
          // - forwarded emails when a mask is not forwarding emails.
          .is-disabled &.forwarded-stat {
            color: tokens.$color-grey-30;
          }

          dd {
            @include mp.text-title-2xs;
            font-family: mp.$font-stack-firefox;
            font-weight: 600;
          }
        }
      }
    }
  }
}

.block-level {
  a {
    color: tokens.$color-blue-50;
    font-weight: 500;

    &:hover {
      text-decoration: underline;
    }
  }

  @media screen and (max-width: mp.$screen-md) {
    display: flex;
    flex-direction: column;
    gap: mp.$spacing-md;
    padding: mp.$spacing-lg;
    $arrowWidth: 6px;

    .block-level-setting-description {
      @include mp.text-body-sm;
      background-color: tokens.$color-grey-05;
      padding: mp.$spacing-lg;
      border-radius: mp.$border-radius-md;
      position: relative;

      &::after {
        content: "";
        height: $arrowWidth * 2;
        width: $arrowWidth * 2;
        position: absolute;
        top: -1 * $arrowWidth;
        transform: rotate(45deg);
        background-color: tokens.$color-grey-05;
      }

      &.without-chevron::after {
        display: none;
      }
    }

    &.is-blocking-none .block-level-setting-description::after {
      left: calc(calc(100% / 6) - (mp.$spacing-md / 2));
    }

    &.is-blocking-promotionals .block-level-setting-description::after {
      left: calc(50% - ($arrowWidth / 2));
    }

    &.is-blocking-all .block-level-setting-description::after {
      right: calc(calc(100% / 6) - (mp.$spacing-md / 2));
    }
  }
  @media screen and #{mp.$mq-md} {
    display: flex;
    align-items: center;
    gap: mp.$spacing-2xl;
    padding: mp.$spacing-lg;

    .block-level-setting {
      flex: 0 0 mp.$content-sm;
    }

    .block-level-setting-description {
      display: flex;
      justify-content: center;
      flex-direction: column;
    }
  }
}

.block-level-control-wrapper {
  display: flex;
  flex-direction: column;
  gap: mp.$spacing-md;

  .block-level-control-label {
    text-align: center;
  }

  .block-level-segmented-control {
    $toggle-border-radius: 40px;
    background-color: tokens.$color-grey-05;
    border-radius: $toggle-border-radius;
    border: mp.$border-radius-xs solid tokens.$color-grey-10;
    padding: mp.$spacing-xs;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: mp.$spacing-md;

    label {
      flex: 1 1 0;
      padding: mp.$spacing-xs mp.$spacing-sm;
      display: flex;
      gap: mp.$spacing-sm;
      align-items: center;
      justify-content: center;
      background-color: tokens.$color-white;
      border-radius: $toggle-border-radius;
      font-weight: 500;
      color: tokens.$color-grey-40;
      cursor: pointer;

      &:not(.is-selected) {
        &:hover {
          background-color: tokens.$color-violet-30;
          color: tokens.$color-white;
        }
      }

      .is-selected &.is-disabled {
        &:hover {
          border: 1px solid tokens.$color-violet-70;
        }
      }

      &.is-selected {
        background-color: tokens.$color-violet-70;
        color: tokens.$color-white;
      }

      &.is-focused {
        outline: 3px solid tokens.$color-blue-50;
      }

      &.is-disabled {
        padding-inline: mp.$spacing-md;
        color: tokens.$color-grey-30;

        @media screen and #{mp.$mq-md} {
          svg {
            flex: 1 1 10px;
          }
        }
      }

      &.promo-selected {
        outline-width: 2px;
        outline-color: tokens.$color-violet-70;
        outline-style: solid;
      }
    }
  }
}

.meta {
  @media screen and (max-width: mp.$screen-md) {
    display: flex;
    flex-direction: column;

    dl {
      @include mp.text-body-sm;
      display: flex;
      flex-direction: column;
      gap: mp.$spacing-md;
      border-top: 1px solid tokens.$color-grey-10;
      padding: mp.$spacing-lg;

      dd {
        font-family: mp.$font-stack-firefox;
        font-weight: 500;

        img {
          display: none;
        }
      }
    }

    .deletion-button-wrapper {
      display: flex;
      flex-direction: column;
      border-top: 1px solid tokens.$color-grey-10;
      padding: mp.$spacing-md;
    }
  }
  @media screen and #{mp.$mq-md} {
    display: flex;
    padding-block: mp.$spacing-lg mp.$spacing-sm;
    border-top: 1px solid tokens.$color-grey-10;

    dl {
      display: flex;
      gap: mp.$spacing-2xl;
      font-weight: 500;

      dt {
        @include mp.text-body-sm;
        color: tokens.$color-grey-50;
      }

      dd {
        display: flex;
        align-items: center;
        gap: mp.$spacing-sm;
        color: tokens.$color-grey-60;
      }
    }

    .deletion-button-wrapper {
      flex: 1 0 auto;
      text-align: end;
    }
  }
}

.promotions-locked-description-wrapper {
  margin-top: mp.$spacing-md;
  background: tokens.$color-grey-05;
  border-radius: mp.$border-radius-md;
  padding: mp.$spacing-md;
  display: flex;
  flex-direction: column;
  gap: mp.$spacing-sm;

  strong {
    display: flex;
    align-items: center;
    gap: mp.$spacing-sm;
    color: tokens.$color-grey-50;
  }
}

.onboarding-open {
  display: none;
}

.onboarding-closed {
  display: block;
}

.onboarding-alias-container {
  width: mp.$content-xs;
  position: absolute;
  padding: mp.$spacing-sm mp.$spacing-md;
  color: tokens.$color-black;
  background: tokens.$color-white;
  border: solid 4px tokens.$color-purple-50;
  border-radius: mp.$border-radius-md;
  right: mp.$spacing-xl;
  box-shadow: mp.$box-shadow-md;
  display: none;

  @media screen and #{mp.$mq-lg} {
    display: block;
  }
}

/* custom art element that requires absolute positioning an informative image that shows the user information about blocking */
.onboarding-alias-container img {
  position: absolute;
  left: -138px;
  top: -21px;
  width: 145px;
}
